# Uart_tx 验证需求与计划

## 1. 背景与目标
- 目标：完成 Uart_tx 数字电路的功能正确性、鲁棒性与可靠性验证，发现并记录潜在设计缺陷。
- 基于现有接口与驱动方式，采用 Step 时钟接口进行时序驱动，输出波形与代码行覆盖率用于度量验证质量。

## 2. DUT 基本信息（来源于 Uart_tx/__init__.py）
- 时钟/复位：
  - PCLK（输入时钟）
  - PRESETn（低有效复位）
- 数据与控制输入：
  - PWDATA[7:0]（待发送数据）
  - tx_fifo_push（写入 TX FIFO 使能）
  - LCR[7:0]（行控制寄存器，影响发送格式等，具体含义以RTL为准）
  - enable（发送总使能）
- 状态与输出：
  - tx_fifo_empty、tx_fifo_full、tx_fifo_count[4:0]
  - busy（发送忙信号）
  - TXD（串行发送线）
- 驱动方式：时序电路，需要注册 PCLK 到时钟管理，使用 Step/StepRis/StepFal 驱动。

## 3. 验证范围与假设
- 范围：
  - 复位流程与寄存器/状态清零行为
  - TX FIFO 行为（写入、满/空标志、计数变化、边界条件）
  - 发送开启/关闭（enable）对 busy/TXD 的影响
  - LCR 对发送帧格式的影响（如数据位、校验/停止位等，按RTL实现为准）
  - TXD 串行输出协议基本时序（起始位、数据位顺序、停止位）
- 合理假设（若后续与RTL不符，以RTL为准并调整计划）：
  - PWDATA 为 8 位数据位基础；
  - PRESETn 低有效、同步释放；
  - FIFO 深度与行为以 tx_fifo_count 位宽推测覆盖边界，但实际以 RTL 为准。

## 4. 输入输出定义与观测点
- 输入激励：PRESETn、PWDATA、tx_fifo_push、LCR、enable；
- 关键观测：TXD 波形、busy、FIFO 标志与计数、必要的内部信号（如需通过 VPI/CFG 观测）。

## 5. 功能需求拆解（验证目标）
- 复位需求：
  - 进入复位后，busy=0，TXD 处于空闲电平（典型为高电平），FIFO 为空（empty=1，full=0，count=0）。
- FIFO 写入/计数：
  - tx_fifo_push 在有效写入周期对 PWDATA 入队；
  - 满/空标志与计数与入队/发送出队行为一致；
  - 边界：满时禁止继续入队；空时无可发送数据。
- 发送使能与时序：
  - enable=1 时允许发送；disable 时应停止/不启动发送（具体停止语义以 RTL 为准）；
  - busy 在发送事务期间应为 1，并在发送完成后拉低；
  - TXD 输出满足 UART 帧结构：start(0) → data LSB first → parity? → stop(1)。
- LCR 影响：
  - 不同 LCR 组合下的帧格式变化与状态行为正确（按 RTL 实际定义选择覆盖）。

## 6. 风险点与边界条件
- PRESETn 异步/同步行为与释放时序；
- FIFO 边界：满/空交替临界、计数翻转、快速写入/发送并发；
- enable 变更时的状态切换（中途关闭/开启）；
- LCR 变更生效时机（发送过程中修改是否允许/影响当前帧）；
- 起始/停止位电平、空闲线电平约定一致性；
- 多帧连续发送与长时序稳定性。

## 7. 验证方法与度量
- 驱动：基于 Step 接口进行周期级驱动，必要时使用 StepRis/StepFal 精细控制；
- 自检：编写检查点与断言比对状态与 TXD 协议时序；
- 覆盖：建立功能覆盖分组与检查点，收集并达到既定覆盖目标；
- 度量：所有用例通过率、关键功能点命中率、代码行覆盖率达标。

## 8. 测试计划与阶段划分
- 阶段 1：需求分析与计划（本文件）
- 阶段 2：DUT 功能理解与信息整理
- 阶段 3：功能分组/功能点/检测点定义与文档沉淀
- 阶段 4：DUT 封装与 fixture 实现（含时钟/波形/覆盖配置）
- 阶段 5：功能覆盖模型与检查实现
- 阶段 6：基础测试环境（Bundle/Mock/env）实现与冒烟
- 阶段 7：基础 API 实现
- 阶段 8：API 功能测试
- 阶段 9：用例模板创建与补全
- 阶段 10：批量实现用例与缺陷分析
- 阶段 11：行覆盖率分析与提升
- 阶段 12：复盘与总结

## 9. 测试用例设计（高层规划）
- 复位类：复位时序、复位后状态检查；
- FIFO 基本：单次写入/多次写入、空→非空、接近满、满、写入抑制；
- 发送基本：单帧发送、连续多帧、空闲线电平、busy 拉高/拉低时机；
- LCR 变体：不同帧格式组合（数据位/校验/停止位），边界值；
- 使能控制：发送中 enable 翻转的语义与影响；
- 鲁棒性：长时间运行、极限数据/模式切换；
- 异常场景：非法 LCR 组合（若 RTL 定义），异常输入时的保护行为。

## 10. 判定标准
- 功能正确性：断言与检查点全部通过；
- 覆盖充分性：功能覆盖组与检查点命中满足计划（后续细化为量化阈值）；
- 行覆盖率：按任务要求达到目标阈值（后续阶段用工具统计并迭代提升）。

## 11. 交付物
- 需求与计划（本文档）、功能与检测点文档、API 与环境代码、测试用例、缺陷分析、测试总结、覆盖率与波形文件。

## 12. 备注
- 若在后续阶段发现 RTL 定义与本计划假设不一致，立即更新计划与用例设计；
- 发现的设计缺陷将记录在 bug 分析文档中，严禁掩盖或误判。
