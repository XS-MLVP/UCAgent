# 模板文件系统

模板文件是 UCAgent 工作流中的"规范指南"，它告诉 Agent 应该生成什么样的输出、遵循什么样的格式和标准。可以说，**模板是 Agent 的参考手册**，确保生成的内容符合预期。

## 为什么需要模板文件？

想象一下，如果你让一个新员工"写一份技术文档"，但不告诉他文档应该包含哪些章节、用什么格式，结果可能千差万别。模板文件就是为了解决这个问题：

1. **统一规范**：确保所有生成的文档格式一致
2. **提供指导**：告诉 Agent 应该关注哪些信息
3. **提高质量**：通过示例和说明提升输出质量
4. **减少迭代**：明确要求减少 Agent 的试错次数

## 模板在工作流中的作用

回顾上一章的工作流配置，我们在每个阶段都指定了 `reference_files`：

```yaml
stage:
  - name: analyze_project
    reference_files:
      - "Guide_Doc/project_analysis_guide.md" # ← 指导文档
    task:
      - "参考 Guide_Doc/project_analysis_guide.md 的指导，提取关键信息"
```

**执行流程**：

1. Agent 进入阶段后，首先读取 `reference_files` 中的所有文件
2. 理解模板中的要求和规范
3. 按照模板的指导执行任务
4. 生成符合模板要求的输出

## Mini-Example 的模板设计

对于计算器文档生成器，我们需要两个模板：

### 模板1：项目分析指南

- **文件名**：`project_analysis_guide.md`
- **用途**：指导 Agent 如何分析项目 README
- **内容**：定义要提取的信息类型和分析方法

### 模板2：文档结构模板

- **文件名**：`documentation_template.md`
- **用途**：定义项目文档的结构和格式
- **内容**：规定必需章节和内容要求

## 模板文件实现

### 模板1：project_analysis_guide.md

```markdown
# 项目分析指南

本文档指导如何分析项目的 README 文件，提取关键信息并生成结构化的分析文档。

## 分析目标

从项目的 README 文件中提取以下信息：

### 1. 项目基本信息

- **项目名称**：{PROJECT} 的全称和简称
- **项目简介**：一句话概括项目的核心价值
- **开发状态**：当前版本号、开发阶段（开发中/已发布/维护中）

### 2. 功能概述

- **核心功能**：列出项目的 3-5 个主要功能
- **扩展功能**：列出可选的高级功能
- **功能特点**：每个功能的独特之处或优势

### 3. 技术特性

- **技术栈**：使用的编程语言、框架、库
- **架构设计**：整体架构思想（如模块化、插件化）
- **性能特性**：如高性能、低延迟、高并发等
- **跨平台支持**：支持的操作系统或平台

### 4. 使用场景

- **目标用户**：谁会使用这个项目
- **应用领域**：适用于哪些行业或场景
- **解决问题**：帮助用户解决什么具体问题

## 输出格式

生成的分析文档应使用 **{DOC_GEN_LANG}** 编写，采用 Markdown 格式，包含以下章节：
```

# {PROJECT} 项目分析

## 项目基本信息

（项目名称、简介、版本等）

## 功能概述

### 核心功能

（列表形式）

### 扩展功能

（列表形式）

## 技术特性

（技术栈、架构、性能等）

## 使用场景

（目标用户、应用领域）

## 分析总结

（整体评价和建议）

```

## 注意事项

1. **信息提取准确**：严格基于 README 内容，不要臆造信息
2. **结构清晰**：使用标题和列表组织内容
3. **语言规范**：使用 {DOC_GEN_LANG}，保持专业术语准确
4. **内容完整**：每个章节都应该有实质性内容，避免空章节
5. **字数控制**：分析文档应在 500-2000 字之间

## 示例片段

**好的功能描述示例**：
```

### 核心功能

- **四则运算**：支持加法、减法、乘法、除法运算，支持括号嵌套
- **科学计算**：提供三角函数、对数函数、幂运算等高级数学功能
- **历史记录**：自动保存最近100条计算记录，支持按日期和表达式查询

```

**不好的功能描述示例**：
```

### 核心功能

- 计算功能
- 其他功能

```
（太笼统，缺少细节）
```

### 模板2：documentation_template.md

```markdown
# 项目文档结构模板

本模板定义了项目文档的标准结构，请严格按照以下格式生成 {PROJECT} 的完整文档。

## 文档结构

项目文档应包含以下 **4个必需章节**，缺一不可：

### 1. 项目概述（必需）

**内容要求**：

- 项目的背景和目的
- 项目的核心价值和定位
- 目标用户和适用场景
- 项目当前状态（版本、开发阶段）

**字数要求**：150-300字

**示例结构**：
```

## 项目概述

{PROJECT} 是一个...（介绍项目背景和目的）

本项目旨在...（说明核心价值）

主要面向...（目标用户）用户，适用于...（应用场景）场景。

当前版本：vX.X.X，处于...（开发阶段）阶段。

```

### 2. 功能说明（必需）
**内容要求**：
- 详细介绍每个核心功能
- 说明功能的使用方法和注意事项
- 如有扩展功能，单独说明

**字数要求**：300-800字

**组织形式**：
```

## 功能说明

### 核心功能

#### 1. 功能A

（详细说明功能A的作用、使用方法、参数说明等）

#### 2. 功能B

（详细说明功能B...）

### 扩展功能

#### 1. 高级功能C

（说明扩展功能...）

```

### 3. 技术架构（必需）
**内容要求**：
- 技术栈（编程语言、框架、依赖库）
- 架构设计（模块划分、组件关系）
- 核心算法或实现原理（如有）
- 性能特性和优化方法

**字数要求**：200-500字

**示例结构**：
```

## 技术架构

### 技术栈

- **编程语言**：Python 3.8+
- **核心框架**：...
- **依赖库**：...

### 架构设计

（描述整体架构、模块划分）

### 核心实现

（说明关键算法或技术要点）

### 性能特性

（说明性能优化措施）

```

### 4. 使用方法（必需）
**内容要求**：
- 安装步骤（如适用）
- 基本使用示例
- 常见使用场景的代码示例
- 注意事项和常见问题

**字数要求**：200-500字

**示例结构**：
```

## 使用方法

### 安装

（安装步骤）

### 基本使用

（简单的使用示例）

### 使用示例

（具体场景的代码示例）

### 注意事项

（使用中需要注意的问题）

````

## 格式规范

### Markdown 格式要求
1. **标题层级**：一级标题用 `#`，二级标题用 `##`，以此类推
2. **列表格式**：无序列表用 `-`，有序列表用 `1.` `2.` 等
3. **代码块**：使用三个反引号包裹代码，指定语言类型
4. **粗体强调**：重要概念用 `**粗体**` 标注
5. **链接格式**：`[链接文本](URL)`

### 语言要求
- 使用 **{DOC_GEN_LANG}** 编写全部内容
- 专业术语使用准确
- 句子通顺，逻辑清晰
- 避免口语化表达

### 质量要求
- **完整性**：4个必需章节都必须包含
- **充实度**：每个章节都应有实质性内容，不能只有标题
- **准确性**：所有信息基于项目实际情况，不臆造
- **规范性**：严格遵循 Markdown 格式规范

## 文档模板示例

以下是一个完整的文档框架示例：

```markdown
# {PROJECT} 项目文档

## 项目概述
（150-300字，介绍项目背景、目的、用户、状态）

## 功能说明

### 核心功能

#### 1. 功能名称A
（详细说明）

#### 2. 功能名称B
（详细说明）

### 扩展功能

#### 1. 高级功能C
（详细说明）

## 技术架构

### 技术栈
- **编程语言**：...
- **核心框架**：...

### 架构设计
（架构描述）

### 核心实现
（实现要点）

## 使用方法

### 安装
（安装步骤）

### 基本使用
（使用示例）

### 注意事项
（注意事项）
````

## 检查清单

在完成文档编写后，请确认：

- [ ] 包含全部4个必需章节
- [ ] 每个章节都有实质性内容（不是空章节）
- [ ] 使用 {DOC_GEN_LANG} 编写
- [ ] 遵循 Markdown 格式规范
- [ ] 总字数在 800-3000 字之间
- [ ] 信息准确，基于实际项目内容
- [ ] 结构清晰，逻辑连贯

````

## 模板变量系统

在模板文件中，您可以使用以下变量，它们会在 Agent 读取时自动替换：

| 变量 | 说明 | 替换值（mini.yaml中定义） |
|------|------|--------------------------|
| `{PROJECT}` | 项目名称 | `Calculator` |
| `{OUT}` | 输出目录 | `output` |
| `{DOC_GEN_LANG}` | 文档语言 | `中文` |

**示例**：
- 模板中写 `生成 {PROJECT} 的文档`
- Agent 读取时变成 `生成 Calculator 的文档`

## 模板文件与指导文档的区别

在 MiniWorkflow 示例中，我们使用 `Guide_Doc/` 目录存放指导文档：

- **概念上**：“模板文件”是 UCAgent 通用概念，指 `reference_files` 引用的规范指导文件
- **实现上**：MiniWorkflow 使用 `Guide_Doc/` 目录名，强调这些是“指导性文档”而非“模板框架”
- **作用相同**：无论目录名如何，都通过 `--guid-doc-path` 参数指定，Agent 读取后作为任务指导

> **注意**：UCAgent 内置的硬件验证工作流使用 `ucagent/lang/zh/doc/Guide_Doc/`，MiniWorkflow 示例通过 `--guid-doc-path` 参数替换为自定义的 `Guide_Doc/` 目录，实现完全自定义的工作流。

## 模板文件位置

模板文件的存放位置通过启动命令的 `--guid-doc-path` 参数指定：

```bash
ucagent output/ Calculator \
  --config mini.yaml \
  --guid-doc-path ./Guide_Doc/  # ← 指定指导文档目录
```

在我们的 mini-example 中，指导文档目录结构如下：

```
examples/MiniWorkflow/
├── Guide_Doc/
│   ├── project_analysis_guide.md      # 分析指南
│   └── documentation_template.md      # 文档结构指导
├── Calculator/
│   └── README.md
├── mini.yaml
└── ...
```

## 模板编写最佳实践

### 1. 明确具体，避免模糊

✅ **好的指导**：

```
提取以下信息：
1. 核心功能（3-5个）
2. 技术栈（编程语言、框架）
3. 使用场景（目标用户、应用领域）
```

❌ **不好的指导**：

```
提取项目信息
```

### 2. 提供示例，便于理解

✅ **好的示例**：

```
**好的功能描述示例**：
- **四则运算**：支持加法、减法、乘法、除法运算，支持括号嵌套

**不好的功能描述示例**：
- 计算功能（太笼统）
```

### 3. 使用检查清单，便于验证

✅ **好的检查清单**：

```
- [ ] 包含全部4个必需章节
- [ ] 每个章节都有实质性内容
- [ ] 使用中文编写
```

## 模板与检查器的配合

模板和检查器是"一对好搭档"：

- **模板**：告诉 Agent "应该怎么做"
- **检查器**：验证 Agent "做得对不对"

**示例**：

- 模板中要求 `文档应包含4个必需章节`
- 检查器 `RequiredSectionsChecker` 验证这4个章节是否都存在
- 如果缺少章节，检查器报错，Agent 根据模板要求补充

## 小结

通过本章，您学会了：

✅ 模板文件在工作流中的作用
✅ 如何设计模板的结构和内容
✅ 如何使用变量让模板更灵活
✅ 模板编写的3条最佳实践

**下一步**：模板定义了"规范"，但 Agent 还需要"能力"来执行任务。接下来我们学习如何开发自定义工具！

👉 继续阅读：[自定义工具](04_custom_tools.md)
````
