
# DUT 缺陷分析文档

## 概述

当测试执行过程中发现某些检查点（Check Point）未能通过时，需要在 `{DUT}_bug_analysis.md` 文档中进行详细的缺陷分析。本文档用于记录和分析测试失败的检查点，评估缺陷的严重程度，并提供根因分析。

## 文档结构

缺陷分析文档包含两个主要部分：
1. **未测试通过检测点分析** - 列出所有失败的检查点及其置信度
2. **缺陷根因分析** - 对失败原因进行深入分析和归类

## 未测试通过检测点分析格式

### 基本语法规则

- 使用功能组标签 `<FG-*>` 对失败检查点进行分组
- 使用功能点标签 `<FC-*>` 标识具体功能
- 使用检查点标签 `<CK-*>` 标识失败的具体检查点
- 使用置信度标签 `<BUG-RATE-x>` 标识缺陷置信度（x取值0-100）

### 置信度评估指南

| 置信度范围 | 含义 | 建议处理方式 |
|-----------|------|-------------|
| 90-100% | 确认存在缺陷 | 立即修复 |
| 70-89% | 很可能存在缺陷 | 优先修复 |
| 50-69% | 可能存在缺陷 | 进一步调查 |
| 20-49% | 不确定是否缺陷 | 低优先级调查 |
| 1-19% | 很可能是测试问题 | 检查测试用例 |
| 0% | 已知忽略点 | 不处理 |

### 完整示例

```markdown
## 未测试通过检测点分析

<FG-ARITHMETIC>

#### 加法功能 <FC-ADD>
- <CK-CIN-OVERFLOW> 带进位的溢出检查：在最大值加法时未正确处理进位输入，导致溢出标志错误，Bug置信度 98% <BUG-RATE-98>
- <CK-BOUNDARY> 边界值处理：当操作数为最大值时，结果计算错误，Bug置信度 85% <BUG-RATE-85>

#### 减法功能 <FC-SUB>
- <CK-BORROW> 借位处理：减法运算中借位逻辑实现不正确，Bug置信度 92% <BUG-RATE-92>
- <CK-UNDERFLOW> 下溢检测：负数结果的下溢标志未正确设置，Bug置信度 75% <BUG-RATE-75>

<FG-LOGIC>

#### 位操作功能 <FC-BITOP>
- <CK-SHL> 左移操作：移位位数超过字长时行为异常，Bug置信度 88% <BUG-RATE-88>
- <CK-SHR> 右移操作：算术右移的符号扩展实现错误，Bug置信度 95% <BUG-RATE-95>

#### 比较功能 <FC-COMPARE>
- <CK-EQUAL> 相等比较：特定输入组合下相等判断失败，原因未明，Bug置信度 15% <BUG-RATE-15>

<FG-CONTROL>

#### 分支预测 <FC-BRANCH>
- <CK-MISPREDICT> 分支预测失败：复杂分支模式下预测准确率低，已知设计限制，Bug置信度 0% <BUG-RATE-0>
```

## 缺陷根因分析

根因分析部分不使用标签，直接使用路径格式（如 `FG-ARITHMETIC/FC-ADD/CK-CIN-OVERFLOW`）来引用失败的检查点。

### 分析框架

每个缺陷分析应包含：
1. **缺陷描述** - 简明扼要描述问题现象
2. **影响范围** - 列出受影响的检查点
3. **根本原因** - 分析问题的根本原因
4. **修复建议** - 提供具体的修复方案
5. **验证方法** - 说明如何验证修复效果

### 根因分析示例

#### 1. 进位处理缺陷

**缺陷描述：** 加法器在处理带进位输入的溢出场景时，未能正确设置溢出标志位。

**影响范围：**
- FG-ARITHMETIC/FC-ADD/CK-CIN-OVERFLOW
- FG-ARITHMETIC/FC-ADD/CK-BOUNDARY

**根本原因：** 
在RTL设计中，溢出检测逻辑只考虑了两个操作数的加法结果，忽略了进位输入对溢出判断的影响。具体来说，当 `(a + b + cin) > MAX_VALUE` 时，应该设置溢出标志，但当前实现只检查了 `(a + b) > MAX_VALUE`。

**修复建议：**
```verilog
// 错误的实现
assign overflow = (a[MSB] & b[MSB] & ~sum[MSB]) | (~a[MSB] & ~b[MSB] & sum[MSB]);

// 正确的实现  
wire [WIDTH:0] full_sum = a + b + cin;
assign overflow = full_sum[WIDTH];
```

**验证方法：** 重新执行涉及 CK-CIN-OVERFLOW 的测试用例，确认溢出标志在边界条件下的正确性。

#### 2. 移位操作缺陷

**缺陷描述：** 左移和右移操作在移位位数等于或超过数据位宽时行为不符合预期。

**影响范围：**
- FG-LOGIC/FC-BITOP/CK-SHL  
- FG-LOGIC/FC-BITOP/CK-SHR

**根本原因：**
设计中未对移位位数进行有效性检查，当移位位数 >= 数据位宽时，应该有明确的行为定义（如清零或保持原值），但当前实现产生了不确定的结果。

**修复建议：**
```verilog
// 添加移位位数检查
wire [5:0] shift_amount = shift_in[5:0]; // 假设64位数据
wire shift_valid = shift_amount < 6'd64;

assign result = shift_valid ? (left_shift ? (data << shift_amount) : (data >> shift_amount)) 
                            : 64'b0; // 超出范围时清零
```

**验证方法：** 使用边界移位位数（63, 64, 65）进行测试，确认结果的一致性。

#### 3. 未知缺陷待调查

**缺陷描述：** 某些检查点失败但暂时无法确定根本原因。

**影响范围：**
- FG-LOGIC/FC-COMPARE/CK-EQUAL

**当前状态：** 正在调查中，需要更详细的仿真分析和波形查看。

**下一步行动：**
1. 收集更多失败案例的输入数据
2. 进行详细的时序仿真分析
3. 检查相关的组合逻辑实现
4. 与设计团队进行技术讨论

## 质量保证要求

### 强制要求

1. **完整性检查**：每个失败的检查点都必须有对应的 `<BUG-RATE-x>` 标签
2. **置信度评估**：置信度必须基于客观分析，不能随意设定
3. **根因分析**：高置信度（>70%）的缺陷必须提供详细的根因分析
4. **修复跟踪**：每个缺陷都应有对应的修复计划和验证方法

### 文档维护

- 缺陷修复后及时更新文档状态
- 保留历史记录以供后续分析参考
- 定期回顾分析质量，持续改进分析方法
